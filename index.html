<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Raksha.ai - Ultimate Safety PWA</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"Raksha SafeSpace","short_name":"Raksha","start_url":".","display":"standalone","background_color":"#050510","theme_color":"#f43f5e","orientation":"portrait","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/2555/2555572.png","sizes":"192x192","type":"image/png"}]}'>
    <meta name="theme-color" content="#050510">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            dark: '#050510',
                            panel: '#0a0a15',
                            accent: '#f43f5e',
                            neon: '#00f0ff'
                        }
                    },
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    animation: {
                        'spin-slow': 'spin 15s linear infinite',
                        'radar': 'radar-spin 8s linear infinite',
                        'breath': 'breath 4s ease-in-out infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'radar-spin': { from: { transform: 'rotate(0deg)' }, to: { transform: 'rotate(360deg)' } },
                        'breath': { '0%, 100%': { transform: 'scale(1)', opacity: '0.5' }, '50%': { transform: 'scale(1.05)', opacity: '0.8' } },
                    }
                }
            }
        }
    </script>

    <style>
        /* CORE STYLES */
        body { 
            background-color: #050510; 
            color: #e2e8f0; 
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-tap-highlight-color: transparent;
            min-height: 100vh;
            overscroll-behavior-y: none;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* SCROLLBAR HIDING */
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }

        /* ADVANCED GLASSMORPHISM */
        .glass-panel {
            background: rgba(20, 20, 35, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
        }
        
        .glass-card {
            background: rgba(10, 10, 20, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), inset 0 0 0 1px rgba(255, 255, 255, 0.02);
        }

        .neon-border {
            box-shadow: 0 0 5px rgba(244, 63, 94, 0.5), inset 0 0 10px rgba(244, 63, 94, 0.2);
            border: 1px solid rgba(244, 63, 94, 0.5);
        }

        /* ANIMATED BACKGROUND */
        .cyber-grid {
            background-image: 
                linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            mask-image: radial-gradient(circle at 50% 50%, black 0%, transparent 80%);
            -webkit-mask-image: radial-gradient(circle at 50% 50%, black 0%, transparent 80%);
        }

        /* SOS REACTOR EFFECT */
        .reactor-core {
            background: radial-gradient(circle at 30% 30%, #fb7185, #e11d48);
            box-shadow: 0 0 60px rgba(225, 29, 72, 0.6), inset 0 0 20px rgba(255, 255, 255, 0.4);
        }
        
        .reactor-ring {
            position: absolute; inset: -20px; border-radius: 50%;
            border: 2px solid rgba(225, 29, 72, 0.3);
            border-top-color: transparent; border-bottom-color: transparent;
            animation: spin-slow 10s linear infinite;
        }
        
        .reactor-ring-2 {
            position: absolute; inset: -10px; border-radius: 50%;
            border: 1px dashed rgba(225, 29, 72, 0.4);
            animation: spin-slow 15s linear infinite reverse;
        }

        .strobe-overlay {
            animation: strobe 0.1s infinite;
            position: fixed; inset: 0; z-index: 100; pointer-events: none;
            background: rgba(255, 0, 0, 0.0);
        }
        @keyframes strobe { 50% { background: rgba(255, 0, 0, 0.15); } }

        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .pb-safe { padding-bottom: calc(1rem + env(safe-area-inset-bottom)); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect, useCallback, useMemo, memo } = React;

        // --- AUTH HOOK ---
        function useAuth() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const storedUser = localStorage.getItem('raksha_user');
                if (storedUser) setUser(JSON.parse(storedUser));
                setLoading(false);
            }, []);

            const login = (email) => {
                setLoading(true);
                setTimeout(() => {
                    const mockUser = { 
                        id: 'demo-user-123', 
                        email: email || 'demo@raksha.ai',
                        name: email ? email.split('@')[0] : 'Commander'
                    };
                    localStorage.setItem('raksha_user', JSON.stringify(mockUser));
                    setUser(mockUser);
                    setLoading(false);
                }, 1000);
            };

            const logout = () => { localStorage.removeItem('raksha_user'); setUser(null); };
            return { user, loading, login, logout };
        }

        // --- ICONS ---
        const Icons = {
            Shield: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Siren: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 18v-6a5 5 0 1 1 10 0v6"/><path d="M5 21a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2"/><path d="M21 12h1"/><path d="M18.5 4.5 20 3"/><path d="M2 12h1"/><path d="M4 3 5.5 4.5"/></svg>,
            Map: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></svg>,
            Users: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>,
            Ghost: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 10h.01"/><path d="M15 10h.01"/><path d="M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"/></svg>,
            Bot: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/></svg>,
            Menu: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            X: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            LogOut: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
            Send: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Phone: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
            PhoneOff: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45"/><path d="M23 1l-22 22"/></svg>,
            ChevronRight: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            AlertTriangle: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>,
            Loading: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56" /></svg>,
            Volume2: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>,
            VolumeX: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" x2="17" y1="9" y2="15"/><line x1="17" x2="23" y1="9" y2="15"/></svg>,
            Mic: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/><line x1="8" x2="16" y1="22" y2="22"/></svg>,
            Navigation: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>,
            Scale: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>,
            Lock: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            ShieldAlert: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
            Database: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s 9-1.34 9-3V5"/></svg>,
            Check: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Eye: (props) => <svg {...props} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
        };

        const FEATURES = [
            { id: 1, title: "SOS Emergency", Icon: Icons.Siren, desc: "One-tap SOS, Shake-to-Alert.", color: "text-rose-500", bg: "bg-rose-500/10" },
            { id: 2, title: "Auto Evidence", Icon: Icons.Mic, desc: "Auto-records 30s audio. Secure upload.", color: "text-blue-400", bg: "bg-blue-400/10" }, 
            { id: 4, title: "Safe Zone Map", Icon: Icons.Map, desc: "Crowdsourced heatmaps. Green for safe.", color: "text-emerald-400", bg: "bg-emerald-400/10" },
            { id: 5, title: "Trusted Circle", Icon: Icons.Users, desc: "Live 'Walk With Me' tracking.", color: "text-pink-400", bg: "bg-pink-400/10" },
            { id: 6, title: "Stealth Tools", Icon: Icons.Ghost, desc: "Fake Call & Calculator disguise.", color: "text-gray-400", bg: "bg-gray-400/10" },
            { id: 7, title: "Travel Safety", Icon: Icons.Navigation, desc: "Route deviation detection.", color: "text-orange-400", bg: "bg-orange-400/10" },
            { id: 9, title: "Legal & Police", Icon: Icons.Scale, desc: "Helpline (112) & Legal AI.", color: "text-yellow-400", bg: "bg-yellow-400/10" },
            { id: 10, title: "Profile Security", Icon: Icons.Lock, desc: "Low-Battery Mode & Secure Pin.", color: "text-cyan-400", bg: "bg-cyan-400/10" },
        ];

        // --- COMPONENTS ---
        const CyberBackground = memo(() => (
            <div className="fixed inset-0 z-[-1] overflow-hidden pointer-events-none bg-[#050510]">
                <div className="absolute top-[-10%] right-[-10%] w-[70vw] h-[70vw] bg-rose-600/10 rounded-full blur-[100px] animate-breath"></div>
                <div className="absolute bottom-[-10%] left-[-10%] w-[70vw] h-[70vw] bg-purple-600/10 rounded-full blur-[100px] animate-breath" style={{animationDelay: '2s'}}></div>
                <div className="absolute inset-0 cyber-grid opacity-20"></div>
            </div>
        ));

        const FeatureCard = memo(({ feature }) => (
            <div className="glass-card p-5 rounded-3xl group h-full flex flex-col transition-all duration-300 active:scale-95 border border-white/5 hover:border-rose-500/30 relative overflow-hidden">
                <div className={`absolute top-0 right-0 p-10 bg-gradient-to-br ${feature.bg} to-transparent opacity-20 rounded-bl-[100px]`}></div>
                <div className={`mb-4 p-3 rounded-2xl w-fit transition-transform duration-300 group-hover:scale-110 ${feature.bg} ${feature.color} relative z-10 shadow-lg ring-1 ring-white/10`}>
                    <feature.Icon className="w-6 h-6" />
                </div>
                <h3 className="text-base font-bold text-white mb-1 relative z-10 tracking-tight group-hover:text-rose-300 transition-colors">{feature.title}</h3>
                <p className="text-slate-400 text-[10px] leading-relaxed relative z-10 font-medium group-hover:text-slate-300">{feature.desc}</p>
            </div>
        ));

        const IntroPage = ({ onEnter }) => {
            const [stats, setStats] = useState(0);
            useEffect(() => {
                const interval = setInterval(() => {
                    setStats(prev => prev < 14000 ? prev + 123 : 14205);
                }, 10);
                return () => clearInterval(interval);
            }, []);

            return (
                <div className="fixed inset-0 z-50 bg-[#050510] flex flex-col items-center justify-center p-6 animate-fade-in bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-900 to-[#050510]">
                    <div className="max-w-md w-full flex flex-col gap-10 text-center relative z-10">
                        <div className="inline-flex mx-auto px-4 py-1.5 rounded-full border border-rose-500/30 bg-rose-500/10 text-[10px] font-mono font-bold text-rose-400 uppercase tracking-widest animate-pulse backdrop-blur-md">
                            Neural Network Active â€¢ v9.2
                        </div>
                        <div>
                            <h1 className="text-7xl font-black tracking-tighter leading-[0.8] text-white mb-2">
                                RAKSHA<span className="text-rose-500">.AI</span>
                            </h1>
                            <p className="text-slate-400 text-sm font-mono tracking-widest uppercase opacity-70">
                                Autonomous Safety Protocol
                            </p>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                             <div className="glass-panel p-4 rounded-2xl border-l-4 border-emerald-500">
                                <div className="text-[10px] text-slate-500 font-bold uppercase">Threats Blocked</div>
                                <div className="text-2xl font-mono text-white">{stats.toLocaleString()}</div>
                             </div>
                             <div className="glass-panel p-4 rounded-2xl border-l-4 border-rose-500">
                                <div className="text-[10px] text-slate-500 font-bold uppercase">Active Agents</div>
                                <div className="text-2xl font-mono text-white">2.4M</div>
                             </div>
                        </div>
                        <button onClick={onEnter} className="group relative w-full py-5 bg-white text-black rounded-2xl font-black text-lg uppercase tracking-widest hover:scale-[1.02] active:scale-95 transition-all shadow-[0_0_40px_rgba(255,255,255,0.2)]">
                            <span className="relative z-10">Initialize System</span>
                        </button>
                    </div>
                </div>
            );
        };

        const AuthScreen = ({ onLogin, loading }) => {
            const [email, setEmail] = useState('');
            return (
                <div className="min-h-screen flex items-center justify-center p-6 animate-fade-in relative z-20">
                    <div className="glass-card w-full max-w-sm p-8 rounded-[2.5rem] border border-white/10 shadow-2xl relative overflow-hidden">
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 bg-gradient-to-br from-rose-600 to-purple-700 rounded-2xl mx-auto flex items-center justify-center shadow-lg mb-6 ring-4 ring-black/50">
                                <Icons.Shield className="w-10 h-10 text-white" />
                            </div>
                            <h2 className="text-2xl font-bold text-white mb-1">Identify Yourself</h2>
                            <p className="text-slate-400 text-xs font-mono">SECURE BIOMETRIC LINK</p>
                        </div>
                        <form onSubmit={(e) => { e.preventDefault(); onLogin(email); }} className="space-y-4">
                            <input type="email" placeholder="Enter Access ID" className="w-full bg-black/20 border border-white/10 rounded-xl px-5 py-4 text-white text-sm focus:border-rose-500 focus:bg-white/5 outline-none transition-all font-mono" value={email} onChange={(e) => setEmail(e.target.value)} />
                            <button disabled={loading} className="w-full py-4 bg-gradient-to-r from-rose-600 to-purple-600 rounded-xl font-bold text-white uppercase tracking-wider text-sm hover:opacity-90 active:scale-95 transition-all flex items-center justify-center gap-2 shadow-lg shadow-rose-600/20">
                                {loading ? <Icons.Loading className="w-5 h-5 animate-spin"/> : 'Authenticate'}
                            </button>
                        </form>
                        <div className="mt-6 pt-6 border-t border-white/5 text-center">
                            <button onClick={() => onLogin('demo@raksha.ai')} className="text-rose-400 text-[10px] font-mono uppercase tracking-widest hover:text-white transition-colors border-b border-rose-500/30 pb-0.5">Initiate Demo Mode</button>
                        </div>
                    </div>
                </div>
            );
        };

        const SOSButton = () => {
            const [active, setActive] = useState(false);
            const [countdown, setCountdown] = useState(3);
            const [status, setStatus] = useState('SYSTEM READY');
            const handlePress = () => {
                if(active) { setActive(false); setStatus('CANCELLED'); setTimeout(() => setStatus('SYSTEM READY'), 2000); return; }
                setActive(true); setCountdown(3); setStatus('ARMING PROTOCOLS...');
                let count = 3;
                const timer = setInterval(() => {
                    count--; setCountdown(count);
                    if(count <= 0) { clearInterval(timer); setStatus('DISTRESS SIGNAL SENT'); if(navigator.vibrate) navigator.vibrate([200, 100, 200]); }
                }, 1000);
            };
            return (
                <div className="flex flex-col items-center justify-center py-10">
                    <div className="relative">
                        {active && (
                            <>
                                <div className="reactor-ring w-64 h-64 border-rose-500/50"></div>
                                <div className="reactor-ring-2 w-72 h-72 border-rose-500/30"></div>
                                <div className="absolute inset-0 bg-rose-500/20 blur-[50px] rounded-full animate-pulse"></div>
                            </>
                        )}
                        <button onClick={handlePress} className={`relative w-48 h-48 rounded-full flex items-center justify-center transition-all duration-300 z-10 ${active ? 'scale-105' : 'hover:scale-105'}`}>
                            <div className={`absolute inset-0 rounded-full reactor-core ${active ? 'animate-pulse-fast' : 'opacity-80'}`}></div>
                            <div className="absolute inset-2 rounded-full border border-white/20 bg-gradient-to-b from-white/10 to-transparent backdrop-blur-sm"></div>
                            <div className="flex flex-col items-center relative z-20">
                                <Icons.Siren className="w-12 h-12 text-white drop-shadow-[0_2px_10px_rgba(0,0,0,0.5)] mb-1" />
                                <span className="text-3xl font-black text-white tracking-widest drop-shadow-md font-mono">SOS</span>
                            </div>
                        </button>
                    </div>
                    <div className="mt-8 font-mono text-rose-500 font-bold uppercase tracking-[0.2em] text-xs bg-black/40 px-4 py-2 rounded-full border border-rose-500/20 backdrop-blur-md">
                        {status === 'ARMING PROTOCOLS...' ? <span className="animate-pulse text-white">SENDING IN {countdown}s</span> : status}
                    </div>
                </div>
            );
        };

        const AdvancedMap = () => {
            const [activeLayers, setActiveLayers] = useState({ heatmap: true, police: true, cctv: false });
            const [selectedZone, setSelectedZone] = useState(null);
            const toggleLayer = (l) => setActiveLayers(prev => ({...prev, [l]: !prev[l]}));

            return (
                <div className="relative w-full h-full bg-[#0a0a15] rounded-[2rem] overflow-hidden border border-white/10 shadow-2xl group">
                    <div className="absolute inset-0 cyber-grid opacity-30"></div>
                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] border border-rose-500/5 rounded-full animate-radar opacity-50"></div>
                    
                    {activeLayers.heatmap && (
                        <>
                            <div className="absolute top-1/3 left-1/3 w-64 h-64 bg-emerald-500/10 rounded-full blur-[80px]"></div>
                            <div className="absolute bottom-1/3 right-1/4 w-40 h-40 bg-rose-500/10 rounded-full blur-[60px] animate-pulse"></div>
                        </>
                    )}
                    
                    <div onClick={() => setSelectedZone({name: 'Sector 7', risk: 'Low', score: 94})} className="absolute top-[40%] left-[30%] cursor-pointer z-10 hover:scale-110 transition-transform">
                        <div className="w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center border border-emerald-500 text-emerald-400 shadow-[0_0_20px_rgba(16,185,129,0.4)]"><Icons.Shield className="w-4 h-4" /></div>
                    </div>
                     <div onClick={() => setSelectedZone({name: 'North Ave', risk: 'High', score: 45})} className="absolute bottom-[30%] right-[35%] cursor-pointer z-10 hover:scale-110 transition-transform">
                        <div className="w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center border border-rose-500 text-rose-500 shadow-[0_0_20px_rgba(244,63,94,0.4)]"><Icons.ShieldAlert className="w-4 h-4" /></div>
                    </div>

                    <div className="absolute top-4 left-4 right-4 flex justify-between items-start pointer-events-none">
                         <div className="pointer-events-auto bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-lg border border-white/10 flex items-center gap-2">
                            <span className="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
                            <span className="text-[10px] text-emerald-400 font-bold uppercase tracking-wider">Live Feed</span>
                        </div>
                    </div>

                    <div className="absolute bottom-4 left-4 flex gap-2 pointer-events-auto">
                        {['heatmap', 'police', 'cctv'].map(l => (
                            <button key={l} onClick={() => toggleLayer(l)} className={`px-3 py-1.5 rounded-lg border text-[9px] font-bold uppercase backdrop-blur-md transition-all ${activeLayers[l] ? 'bg-rose-500/20 border-rose-500 text-rose-300' : 'bg-black/40 border-white/10 text-slate-500'}`}>{l}</button>
                        ))}
                    </div>

                    {selectedZone && (
                        <div className="absolute bottom-16 left-4 right-4 bg-black/80 backdrop-blur-xl p-4 rounded-2xl border border-white/10 animate-fade-in z-20">
                            <div className="flex justify-between items-start mb-2">
                                <div><h4 className="text-white font-bold">{selectedZone.name}</h4><p className="text-[10px] text-slate-400 uppercase tracking-wider">Safety Score</p></div>
                                <div className={`text-2xl font-black ${selectedZone.score > 80 ? 'text-emerald-400' : 'text-rose-500'}`}>{selectedZone.score}</div>
                            </div>
                            <button onClick={() => setSelectedZone(null)} className="absolute top-2 right-2 text-slate-500 hover:text-white"><Icons.X className="w-4 h-4"/></button>
                        </div>
                    )}
                </div>
            );
        };

        const FakeCall = ({ onClose }) => {
            const [status, setStatus] = useState('incoming');
            return (
                <div className="fixed inset-0 z-[100] bg-black/95 backdrop-blur-xl flex flex-col items-center justify-between py-20 animate-fade-in">
                    {status === 'incoming' ? (
                        <>
                            <div className="text-center"><div className="w-24 h-24 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center"><Icons.Users className="w-12 h-12 text-gray-500"/></div><h2 className="text-3xl text-white font-medium">Mom</h2><p className="text-gray-400">Mobile</p></div>
                            <div className="w-full max-w-xs flex justify-between px-8"><button onClick={onClose} className="flex flex-col items-center gap-2"><div className="w-16 h-16 bg-rose-500 rounded-full flex items-center justify-center"><Icons.PhoneOff className="w-8 h-8 text-white"/></div><span className="text-white text-sm">Decline</span></button><button onClick={() => setStatus('active')} className="flex flex-col items-center gap-2"><div className="w-16 h-16 bg-emerald-500 rounded-full flex items-center justify-center animate-bounce"><Icons.Phone className="w-8 h-8 text-white"/></div><span className="text-white text-sm">Accept</span></button></div>
                        </>
                    ) : (
                        <>
                            <div className="text-center mt-12"><h2 className="text-3xl text-white font-medium">Mom</h2><p className="text-emerald-400 mt-2 font-mono">00:14</p></div>
                            <div className="grid grid-cols-3 gap-6 mb-12">{[1,2,3,4,5,6].map(i => <div key={i} className="w-16 h-16 rounded-full bg-white/10 border border-white/5 flex items-center justify-center"><div className="w-1 h-1 bg-white rounded-full"></div></div>)}</div>
                            <button onClick={onClose} className="w-16 h-16 bg-rose-500 rounded-full flex items-center justify-center mb-8"><Icons.PhoneOff className="w-8 h-8 text-white"/></button>
                        </>
                    )}
                </div>
            );
        };

        const ChatInterface = () => {
            const [messages, setMessages] = useState([{ id: 1, text: "Raksha AI Legal Sentinel Online. How can I assist?", sender: 'bot' }]);
            const [input, setInput] = useState('');
            const scrollRef = useRef(null);
            useEffect(() => { scrollRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);
            const send = () => {
                if(!input.trim()) return;
                setMessages(prev => [...prev, { id: Date.now(), text: input, sender: 'user' }]);
                setInput('');
                setTimeout(() => setMessages(prev => [...prev, { id: Date.now()+1, text: "Incident logged. Connecting you to local authorities.", sender: 'bot' }]), 1500);
            };
            return (
                <div className="flex flex-col h-[60vh] md:h-full bg-black/20 rounded-[2rem] border border-white/10 overflow-hidden">
                    <div className="p-4 bg-white/5 border-b border-white/5 flex items-center gap-3"><div className="w-2 h-2 rounded-full bg-rose-500 animate-pulse"></div><span className="text-xs font-bold uppercase tracking-widest">Legal Sentinel AI</span></div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {messages.map(m => (<div key={m.id} className={`flex ${m.sender === 'user' ? 'justify-end' : 'justify-start'}`}><div className={`max-w-[80%] p-3 rounded-2xl text-sm ${m.sender === 'user' ? 'bg-rose-600 text-white' : 'bg-white/10 text-slate-200'}`}>{m.text}</div></div>))}
                        <div ref={scrollRef}></div>
                    </div>
                    <div className="p-3 bg-white/5 border-t border-white/5 flex gap-2"><input value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && send()} placeholder="Type query..." className="flex-1 bg-transparent border-none outline-none text-white text-sm" /><button onClick={send} className="p-2 bg-rose-600 rounded-xl text-white"><Icons.Send className="w-4 h-4" /></button></div>
                </div>
            );
        };

        const App = () => {
            const { user, loading, login, logout } = useAuth();
            const [view, setView] = useState('intro');
            const [sirenOn, setSirenOn] = useState(false);
            const [fakeCallOpen, setFakeCallOpen] = useState(false);
            const sirenAudio = useRef(new Audio("https://cdn.freesound.org/previews/336/336899_4939433-lq.mp3"));

            const toggleSiren = () => {
                if(sirenOn) { sirenAudio.current.pause(); sirenAudio.current.currentTime = 0; }
                else { sirenAudio.current.loop = true; sirenAudio.current.play().catch(console.error); }
                setSirenOn(!sirenOn);
            };

            useEffect(() => {
                if (view === 'intro') return;
                if (!user && view !== 'auth') setView('auth');
                if (user && view === 'auth') setView('home');
            }, [user, view]);

            const NavItem = ({ id, icon: Icon, label }) => (
                <button onClick={() => setView(id)} className={`flex flex-col items-center gap-1 p-2 transition-colors duration-300 ${view === id ? 'text-rose-500' : 'text-slate-500 hover:text-slate-300'}`}>
                    <Icon className="w-6 h-6" /><span className="text-[10px] font-bold uppercase tracking-wide">{label}</span>
                </button>
            );

            if (view === 'intro') return <IntroPage onEnter={() => setView('auth')} />;
            if (!user) return <AuthScreen onLogin={login} loading={loading} />;

            return (
                <div className="min-h-screen flex flex-col relative overflow-hidden font-sans">
                    <CyberBackground />
                    {sirenOn && <div className="strobe-overlay"></div>}
                    {fakeCallOpen && <FakeCall onClose={() => setFakeCallOpen(false)} />}

                    <header className="sticky top-0 z-40 bg-[#050510]/80 backdrop-blur-xl border-b border-white/5 px-6 py-4 flex items-center justify-between">
                        <div className="flex items-center gap-3"><div className="bg-gradient-to-br from-rose-600 to-purple-700 p-2 rounded-lg shadow-lg shadow-rose-600/20"><Icons.Shield className="w-5 h-5 text-white" /></div><span className="text-xl font-black text-white tracking-tighter">RAKSHA<span className="text-rose-500">.AI</span></span></div>
                        <div className="flex items-center gap-4">
                            <div className="hidden md:flex items-center gap-6 mr-4">
                                {['home', 'protocol', 'map', 'legal'].map(v => <button key={v} onClick={() => setView(v)} className={`text-xs font-bold uppercase hover:text-rose-500 transition-colors ${view === v ? 'text-rose-500' : 'text-slate-400'}`}>{v}</button>)}
                            </div>
                            <button onClick={logout} className="p-2 bg-white/5 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-colors"><Icons.LogOut className="w-4 h-4" /></button>
                        </div>
                    </header>

                    <main className="flex-1 max-w-7xl mx-auto w-full p-6 animate-fade-in pb-32 md:pb-6 overflow-hidden">
                        {view === 'home' && (
                            <div className="flex flex-col h-full justify-between pt-4 pb-20 md:justify-center md:pb-0 min-h-[75vh]">
                                <div className="text-center space-y-2">
                                    <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-emerald-500/30 bg-emerald-500/5 text-[10px] font-mono font-bold text-emerald-400 uppercase tracking-widest"><span className="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>Secure Link Active</div>
                                    <h1 className="text-4xl font-black text-white">HELLO, <span className="text-transparent bg-clip-text bg-gradient-to-r from-rose-500 to-purple-500">{user.name.toUpperCase()}</span></h1>
                                </div>
                                
                                <SOSButton />

                                <div className="w-full max-w-md mx-auto">
                                    <div className="text-center mb-4"><span className="text-[10px] text-slate-500 uppercase tracking-[0.3em] font-bold">Tactical Dock</span></div>
                                    <div className="glass-panel p-2 rounded-2xl flex gap-2">
                                        <button onClick={() => setFakeCallOpen(true)} className="flex-1 py-4 rounded-xl hover:bg-white/5 active:bg-white/10 transition-colors flex flex-col items-center gap-2 group">
                                            <Icons.Ghost className="w-6 h-6 text-purple-400 group-hover:scale-110 transition-transform"/>
                                            <span className="text-[10px] font-bold uppercase text-slate-300">Stealth</span>
                                        </button>
                                        <div className="w-px bg-white/5 my-2"></div>
                                        <button onClick={toggleSiren} className={`flex-1 py-4 rounded-xl transition-all flex flex-col items-center gap-2 group ${sirenOn ? 'bg-rose-500/20 shadow-[inset_0_0_20px_rgba(244,63,94,0.2)]' : 'hover:bg-white/5'}`}>
                                            {sirenOn ? <Icons.VolumeX className="w-6 h-6 text-rose-500 animate-pulse"/> : <Icons.Volume2 className="w-6 h-6 text-rose-400 group-hover:scale-110 transition-transform"/>}
                                            <span className={`text-[10px] font-bold uppercase ${sirenOn ? 'text-rose-500' : 'text-slate-300'}`}>Siren</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'protocol' && (
                            <div className="w-full animate-fade-in">
                                <div className="text-center mb-8"><h2 className="text-3xl font-black text-white uppercase tracking-tight">Active Protocols</h2><p className="text-slate-400 text-xs font-mono mt-1">SELECT MODULE TO ENGAGE</p></div>
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">{FEATURES.map(f => <FeatureCard key={f.id} feature={f} />)}</div>
                            </div>
                        )}

                        {view === 'map' && (
                            <div className="h-full flex flex-col md:flex-row gap-6 animate-fade-in max-h-[85vh]">
                                <div className="flex-1 flex flex-col h-full min-h-[60vh] relative">
                                    <div className="flex items-center justify-between mb-4 flex-shrink-0">
                                        <h2 className="text-xl font-bold text-white">Global Intel</h2>
                                        <div className="px-2 py-1 bg-rose-500/10 border border-rose-500/20 rounded text-[10px] text-rose-400 font-mono">LIVE SATELLITE</div>
                                    </div>
                                    <div className="flex-1 rounded-[2rem] overflow-hidden shadow-2xl border border-white/10"><AdvancedMap /></div>
                                </div>
                            </div>
                        )}

                        {view === 'legal' && (
                            <div className="h-full flex flex-col md:flex-row gap-6 max-h-[80vh] animate-fade-in">
                                <div className="md:w-1/3 glass-card p-6 rounded-[2rem] space-y-6 overflow-y-auto">
                                    <h2 className="text-2xl font-bold text-white">Legal Command</h2>
                                    <div className="space-y-4">
                                        <div className="p-4 bg-rose-900/20 border border-rose-500/30 rounded-xl"><h3 className="text-rose-400 font-bold text-sm mb-1">EMERGENCY: 100</h3><p className="text-xs text-slate-400">Police Rapid Response</p></div>
                                        <div className="p-4 bg-purple-900/20 border border-purple-500/30 rounded-xl"><h3 className="text-purple-400 font-bold text-sm mb-1">WOMEN HELPLINE: 1091</h3><p className="text-xs text-slate-400">24/7 Support Cell</p></div>
                                    </div>
                                    <div className="border-t border-white/10 pt-4"><h4 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-3">Your Rights</h4><ul className="space-y-3 text-sm text-slate-300"><li className="flex gap-2"><div className="w-1.5 h-1.5 rounded-full bg-emerald-400 mt-1.5"></div>Zero FIR Registration</li><li className="flex gap-2"><div className="w-1.5 h-1.5 rounded-full bg-emerald-400 mt-1.5"></div>No Arrest After Sunset</li></ul></div>
                                </div>
                                <div className="md:w-2/3"><ChatInterface /></div>
                            </div>
                        )}
                    </main>

                    <nav className="md:hidden fixed bottom-0 w-full bg-[#050510]/90 backdrop-blur-xl border-t border-white/10 pb-safe z-50">
                        <div className="flex justify-around items-center h-20 px-4">
                            <NavItem id="home" icon={Icons.Shield} label="Home" />
                            <NavItem id="protocol" icon={Icons.ShieldAlert} label="Protocol" />
                            <NavItem id="map" icon={Icons.Map} label="Map" />
                            <NavItem id="legal" icon={Icons.Database} label="Legal" />
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html> 

